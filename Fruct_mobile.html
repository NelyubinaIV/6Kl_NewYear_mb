<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–≤–∏ —Ñ—Ä—É–∫—Ç—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        #gameContainer {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
        }
        
        canvas {
            display: block;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 100%);
        }
        
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        /* –º–∞–ª–µ–Ω—å–∫–∞—è –∫–Ω–æ–ø–∫–∞ "–ü—Ä–∞–≤–∏–ª–∞" –≤ –ø–∞–Ω–µ–ª–∏ */
        #ui .small-btn {
            pointer-events: auto;
            background: rgba(0,0,0,0.35);
            border: none;
            color: #fff;
            padding: 8px 16px;
            margin-left: 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            font-weight: normal;
        }

        #ui .small-btn:hover {
            background: rgba(0,0,0,0.5);
        }
        
        #modal {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 500px;
            width: 90%;
            z-index: 100;
        }
        
        #modal h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        #modal p {
            color: #333;
            font-size: 18px;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        #questionModal {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 90%;
            z-index: 100;
        }
        
        #questionModal h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        #questionText {
            color: #333;
            font-size: 20px;
            margin-bottom: 30px;
            line-height: 1.6;
            font-weight: bold;
        }
        
        .answer-btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            font-size: 18px;
            border-radius: 15px;
            cursor: pointer;
            margin: 15px 0;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: left;
        }
        
        .answer-btn:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        #fireworks {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            display: none;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ */
        #rulesModal {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 90%;
            z-index: 100;
            text-align: left;
        }

        #rulesModal h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 24px;
        }

        #rulesModal ul {
            margin-left: 20px;
            margin-bottom: 25px;
            color: #333;
            font-size: 18px;
            line-height: 1.6;
        }
    

/* --- Mobile friendly canvas --- */
#gameContainer {
  width: min(94vw, 860px);
  margin: 0 auto;
}

#gameCanvas {
  width: 100%;
  height: auto;
  touch-action: none; /* —á—Ç–æ–±—ã –ø—Ä–∏ —Å–≤–∞–π–ø–µ –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–ª–æ —Å—Ç—Ä–∞–Ω–∏—Ü—É */
  border-radius: 18px;
}

/* –ú–æ–¥–∞–ª–∫–∏ ‚Äî —á—Ç–æ–±—ã –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –Ω–µ –æ–±—Ä–µ–∑–∞–ª–∏—Å—å */
.modal-content, .question-modal-content, .rules-modal-content {
  max-height: 92dvh;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

@media (max-width: 600px) {
  body { padding: 12px; }
  #ui { gap: 10px; flex-wrap: wrap; }
  #ui > div { font-size: 18px; }
  #rulesButton { padding: 10px 14px; font-size: 16px; }
}

</style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <canvas id="fireworks" width="800" height="600"></canvas>
        
        <div id="ui">
            <div>–û—á–∫–∏: <span id="score">0</span></div>
            <div>
                –ñ–∏–∑–Ω–∏: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                <button id="rulesButton" class="small-btn">–ü—Ä–∞–≤–∏–ª–∞</button>
            </div>
        </div>
        
        <div id="modal">
            <h2 id="modalTitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <p id="modalText">–£–ø—Ä–∞–≤–ª—è–π –∫–æ—Ä–∑–∏–Ω–æ–π —Å—Ç—Ä–µ–ª–∫–∞–º–∏ –∏–ª–∏ –º—ã—à—å—é, –ª–æ–≤–∏ —Ñ—Ä—É–∫—Ç—ã! –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π –∏—Ö!</p>
            <button class="btn" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
        
        <div id="questionModal">
            <h3>–í–æ–ø—Ä–æ—Å –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É</h3>
            <p id="questionText"></p>
            <button class="answer-btn" onclick="answerQuestion(0)"></button>
            <button class="answer-btn" onclick="answerQuestion(1)"></button>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏–≥—Ä—ã -->
        <div id="rulesModal">
            <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h3>
            <ul>
                <li>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–æ—Ä–∑–∏–Ω–æ–π —Å –ø–æ–º–æ—â—å—é —Å—Ç—Ä–µ–ª–æ–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏–ª–∏ –º—ã—à–∏.</li>
                <li>–õ–æ–≤–∏—Ç–µ –ø–∞–¥–∞—é—â–∏–µ —Ñ—Ä—É–∫—Ç—ã ‚Äî –∑–∞ –∫–∞–∂–¥—ã–π —Ñ—Ä—É–∫—Ç –ø–æ–ª—É—á–∞–µ—Ç–µ 1 –æ—á–∫–æ.</li>
                <li>–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π —Ñ—Ä—É–∫—Ç –æ—Ç–Ω–∏–º–∞–µ—Ç –æ–¥–Ω—É –∂–∏–∑–Ω—å. –í—Å–µ–≥–æ —É –≤–∞—Å 3 –∂–∏–∑–Ω–∏.</li>
                <li>–ö–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É. –û—Ç–≤–µ—á–∞–π—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ!</li>
                <li>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç–Ω–∏–º–∞–µ—Ç 5 –æ—á–∫–æ–≤, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</li>
                <li>–ù–∞–±–µ—Ä–∏—Ç–µ 50 –æ—á–∫–æ–≤, —á—Ç–æ–±—ã –ø–æ–±–µ–¥–∏—Ç—å.</li>
            </ul>
            <button class="btn" onclick="closeRules()">–ü–æ–Ω—è—Ç–Ω–æ, –∏–≥—Ä–∞—Ç—å!</button>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const fireworksCanvas = document.getElementById('fireworks');
        const fireworksCtx = fireworksCanvas.getContext('2d');
        
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ—Ä—É–∫—Ç–æ–≤ - –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–∏ URL
        const fruitImages = {
            apple: '', // –í—Å—Ç–∞–≤—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —è–±–ª–æ–∫–∞
            banana: '', // –í—Å—Ç–∞–≤—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–Ω–∞–Ω–∞
            orange: '', // –í—Å—Ç–∞–≤—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–ø–µ–ª—å—Å–∏–Ω–∞
            grape: '', // –í—Å—Ç–∞–≤—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∏–Ω–æ–≥—Ä–∞–¥–∞
            strawberry: '' // –í—Å—Ç–∞–≤—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª—É–±–Ω–∏–∫–∏
        };
        
        // –≠–º–æ–¥–∑–∏ —Ñ—Ä—É–∫—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –µ—Å–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
        const fruitEmojis = ['üçé', 'üçå', 'üçä', 'üçá', 'üçì', 'üçâ', 'üçë', 'üçí'];
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—É–∫–æ–≤ —Å –ø–æ–º–æ—â—å—é Web Audio API (—Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω)
        let audioContext = null;
        
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ audio context –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }
        
        function playSound(type) {
            initAudio();
            
            switch(type) {
                case 'catch': // –ó–≤—É–∫ –ø–æ–∏–º–∫–∏ —Ñ—Ä—É–∫—Ç–∞
                    {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(783.99, audioContext.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.15);
                    }
                    break;
                    
                case 'lose': // –ó–≤—É–∫ –ø–æ—Ç–µ—Ä–∏ –∂–∏–∑–Ω–∏
                    {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(220, audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.35);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.35);
                    }
                    break;
                    
                case 'correct': // –ó–≤—É–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                    {
                        const notes = [523.25, 659.25, 783.99];
                        notes.forEach((freq, i) => {
                            const osc = audioContext.createOscillator();
                            const gain = audioContext.createGain();
                            osc.connect(gain);
                            gain.connect(audioContext.destination);
                            osc.type = 'sine';
                            osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.1);
                            gain.gain.setValueAtTime(0.25, audioContext.currentTime + i * 0.1);
                            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
                            osc.start(audioContext.currentTime + i * 0.1);
                            osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
                        });
                    }
                    break;
                    
                case 'wrong': // –ó–≤—É–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                    {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        oscillator.type = 'square';
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.2);
                    }
                    break;
                    
                case 'win': // –ó–≤—É–∫ –ø–æ–±–µ–¥—ã
                    {
                        const winNotes = [523.25, 659.25, 783.99, 1046.50];
                        winNotes.forEach((freq, i) => {
                            const osc = audioContext.createOscillator();
                            const gain = audioContext.createGain();
                            osc.connect(gain);
                            gain.connect(audioContext.destination);
                            osc.type = 'sine';
                            osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.15);
                            gain.gain.setValueAtTime(0.3, audioContext.currentTime + i * 0.15);
                            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.5);
                            osc.start(audioContext.currentTime + i * 0.15);
                            osc.stop(audioContext.currentTime + i * 0.15 + 0.5);
                        });
                    }
                    break;
            }
        }
        
        // –í–æ–ø—Ä–æ—Å—ã –ø–æ –ø—Ä–∞–≤–æ–ø–∏—Å–∞–Ω–∏—é –≥–ª–∞—Å–Ω—ã—Ö –≤ –∫–æ—Ä–Ω—è—Ö —Å —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ–º
        const questions = [
            {
                question: '–í —Å–ª–æ–≤–µ "–∑..—Ä—è" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ?',
                answers: ['–ê (–±–µ–∑ —É–¥–∞—Ä–µ–Ω–∏—è –≤ –∫–æ—Ä–Ω–µ –∑–∞—Ä/–∑–æ—Ä –ø–∏—à–µ—Ç—Å—è –ê)', '–û (–ø–æ–¥ —É–¥–∞—Ä–µ–Ω–∏–µ–º –ø–∏—à–µ—Ç—Å—è —Ç–æ, —á—Ç–æ —Å–ª—ã—à–∏—Ç—Å—è)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–∑–∞–≥..—Ä–µ—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–ø–æ–¥ —É–¥–∞—Ä–µ–Ω–∏–µ–º –≤ –≥–∞—Ä/–≥–æ—Ä)', '–û (–±–µ–∑ —É–¥–∞—Ä–µ–Ω–∏—è –≤ –≥–∞—Ä/–≥–æ—Ä –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "—Ä..—Å—Ç–µ–Ω–∏–µ" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–ø–µ—Ä–µ–¥ –°–¢, –© –≤ —Ä–∞—Å—Ç/—Ä–∞—â/—Ä–æ—Å –ø–∏—à–µ—Ç—Å—è –ê)', '–û (–ø–µ—Ä–µ–¥ –° –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–ø—Ä–µ–¥–ª..–∂–∏—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–ø–µ—Ä–µ–¥ –ì –≤ –ª–∞–≥/–ª–æ–∂)', '–û (–ø–µ—Ä–µ–¥ –ñ –≤ –ª–∞–≥/–ª–æ–∂ –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–∫..—Å–∞—Ç—å—Å—è" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –ê –ø–æ—Å–ª–µ –∫–æ—Ä–Ω—è)', '–û (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞ –ê)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "—Å–æ–±..—Ä–∞—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ï (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞ –ê)', '–ò (–µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –ê –ø–æ—Å–ª–µ –∫–æ—Ä–Ω—è)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–≤—ã—Ç..—Ä–µ—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ï (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞ –ê –ø–æ—Å–ª–µ –∫–æ—Ä–Ω—è)', '–ò (–µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –ê)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–±–ª..—Å—Ç–∞—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ï (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞ –ê)', '–ò (–µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –ê –ø–æ—Å–ª–µ –∫–æ—Ä–Ω—è)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–æ—Ç—Ä..—Å–ª—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ)', '–û (–û –ø–µ—Ä–µ–¥ –°)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "—Ä..—Å—Ç–æ–∫" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–ø–µ—Ä–µ–¥ –°–¢, –© –≤ —Ä–∞—Å—Ç/—Ä–∞—â/—Ä–æ—Å –ø–∏—à–µ—Ç—Å—è –ê)', '–û (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–æ—Ç–∫–ª..–Ω–µ–Ω–∏–µ" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–ø–æ–¥ —É–¥–∞—Ä–µ–Ω–∏–µ–º)', '–û (–±–µ–∑ —É–¥–∞—Ä–µ–Ω–∏—è –≤ –∫–ª–∞–Ω/–∫–ª–æ–Ω –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–≤—ã—Ä..—Å—Ç–∏" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–ø–µ—Ä–µ–¥ –°–¢/–© –≤ —Ä–∞—Å—Ç/—Ä–∞—â/—Ä–æ—Å)', '–û (–ø–µ—Ä–µ–¥ –° –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "—Å–∫..–∫–∞—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–ø–µ—Ä–µ–¥ –ö –≤ —Å–∫–∞–∫/—Å–∫–æ—á –ø–∏—à–µ—Ç—Å—è –ê)', '–û (–ø–µ—Ä–µ–¥ –ß –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–ø–æ–¥—Å–∫..—á–∏—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ê (–ø–µ—Ä–µ–¥ –ö –ø–∏—à–µ—Ç—Å—è –ê)', '–û (–ø–µ—Ä–µ–¥ –ß –≤ —Å–∫–∞–∫/—Å–∫–æ—á –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–∑–∞–º..—Ä–µ—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ï (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞ –ê –ø–æ—Å–ª–µ –∫–æ—Ä–Ω—è)', '–ò (–µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –ê)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–≤—ã–∂..–≥–∞—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ï (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞ –ê)', '–ò (–µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –ê –ø–æ—Å–ª–µ –∫–æ—Ä–Ω—è)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–ø–æ—Å—Ç..–ª–∏—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ï (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞ –ê)', '–ò (–µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –ê –ø–æ—Å–ª–µ –∫–æ—Ä–Ω—è)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–≤—ã—á..—Ç–∞—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
                answers: ['–ï (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞ –ê)', '–ò (–µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –ê –ø–æ—Å–ª–µ –∫–æ—Ä–Ω—è)'],
                correct: 1
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–ø–æ–ª..–≥–∞—Ç—å" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
               answers: ['–ê (–ø–µ—Ä–µ–¥ –ì –≤ –ª–∞–≥/–ª–æ–∂)', '–û (–ø–µ—Ä–µ–¥ –ñ –≤ –ª–∞–≥/–ª–æ–∂ –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 0
            },
            {
                question: '–í —Å–ª–æ–≤–µ "–ø–æ–∫–ª..–Ω–∏—Ç—å—Å—è" –∫–∞–∫–∞—è –±—É–∫–≤–∞ –ø–∏—à–µ—Ç—Å—è?',
               answers: ['–ê (–ø–æ–¥ —É–¥–∞—Ä–µ–Ω–∏–µ–º)', '–û (–±–µ–∑ —É–¥–∞—Ä–µ–Ω–∏—è –≤ –∫–ª–∞–Ω/–∫–ª–æ–Ω –ø–∏—à–µ—Ç—Å—è –û)'],
                correct: 1
            }
        ];
        
        let gameState = {
            score: 0,
            lives: 3,
            isPlaying: false,
            isPaused: false,
            basket: { x: 350, y: 530, width: 100, height: 60 },
            fruits: [],
            mouseX: 350,
            lastQuestionScore: 0,
            usedQuestions: [],
            won: false
        };
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à—å—é/—Ç–∞—á–µ–º (–æ–¥–∏–Ω–∞–∫–æ–≤–æ) ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ iframe –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
        const setPointerX = (clientX) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            gameState.mouseX = (clientX - rect.left) * scaleX;
        };

        let pointerActive = false;

        canvas.addEventListener('pointerdown', (e) => {
            pointerActive = true;
            if (canvas.setPointerCapture) canvas.setPointerCapture(e.pointerId);
            setPointerX(e.clientX);
            e.preventDefault();
        }, { passive: false });

        canvas.addEventListener('pointermove', (e) => {
            if (e.pointerType === 'mouse' || pointerActive) {
                setPointerX(e.clientX);
            }
        }, { passive: true });

        canvas.addEventListener('pointerup', () => { pointerActive = false; }, { passive: true });
        canvas.addEventListener('pointercancel', () => { pointerActive = false; }, { passive: true });

        // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä—ã—Ö iOS (–µ—Å–ª–∏ pointer-events –æ—Ç–∫–ª—é—á–µ–Ω—ã)
        canvas.addEventListener('touchstart', (e) => {
            const t = e.touches[0];
            if (!t) return;
            setPointerX(t.clientX);
            e.preventDefault();
        }, { passive: false });
        canvas.addEventListener('touchmove', (e) => {
            const t = e.touches[0];
            if (!t) return;
            setPointerX(t.clientX);
            e.preventDefault();
        }, { passive: false });

        
        function startGame() {
            document.getElementById('modal').style.display = 'none';
            initAudio(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∏–≥—Ä—ã
            gameState.score = 0;
            gameState.lives = 3;
            gameState.isPlaying = true;
            gameState.isPaused = false;
            gameState.fruits = [];
            gameState.lastQuestionScore = 0;
            gameState.usedQuestions = [];
            gameState.won = false;
            updateUI();
            gameLoop();
        }
        
        function spawnFruit() {
            const fruit = {
                x: Math.random() * (canvas.width - 60) + 30,
                y: -60,
                size: 50,
                speed: 2 + Math.random() * 2,
                emoji: fruitEmojis[Math.floor(Math.random() * fruitEmojis.length)]
            };
            gameState.fruits.push(fruit);
        }
        
        function updateBasket() {
            if (keys['ArrowLeft'] && gameState.basket.x > 0) {
                gameState.basket.x -= 8;
            }
            if (keys['ArrowRight'] && gameState.basket.x < canvas.width - gameState.basket.width) {
                gameState.basket.x += 8;
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à—å—é
            const targetX = gameState.mouseX - gameState.basket.width / 2;
            if (Math.abs(targetX - gameState.basket.x) > 5) {
                gameState.basket.x += (targetX - gameState.basket.x) * 0.15;
            }
            
            gameState.basket.x = Math.max(0, Math.min(canvas.width - gameState.basket.width, gameState.basket.x));
        }
        
        function updateFruits() {
            for (let i = gameState.fruits.length - 1; i >= 0; i--) {
                const fruit = gameState.fruits[i];
                fruit.y += fruit.speed;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏–º–∫–∏
                if (fruit.y + fruit.size > gameState.basket.y &&
                    fruit.y < gameState.basket.y + gameState.basket.height &&
                    fruit.x + fruit.size > gameState.basket.x &&
                    fruit.x < gameState.basket.x + gameState.basket.width) {
                    gameState.score++;
                    gameState.fruits.splice(i, 1);
                    playSound('catch'); // –ó–≤—É–∫ –ø–æ–∏–º–∫–∏
                    updateUI();
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤
                    if (gameState.score % 5 === 0 && gameState.score !== gameState.lastQuestionScore) {
                        if (gameState.score >= 50) {
                            winGame();
                        } else {
                            showQuestion();
                        }
                    }
                    continue;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞
                if (fruit.y > canvas.height) {
                    gameState.lives--;
                    gameState.fruits.splice(i, 1);
                    playSound('lose'); // –ó–≤—É–∫ –ø–æ—Ç–µ—Ä–∏ –∂–∏–∑–Ω–∏
                    updateUI();
                    
                    if (gameState.lives <= 0) {
                        endGame();
                    }
                }
            }
        }
        
        function drawBasket() {
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(gameState.basket.x, gameState.basket.y, gameState.basket.width, gameState.basket.height);
            
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 3;
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.moveTo(gameState.basket.x + i * 20, gameState.basket.y);
                ctx.lineTo(gameState.basket.x + i * 20, gameState.basket.y + gameState.basket.height);
                ctx.stroke();
            }
            
            ctx.beginPath();
            ctx.arc(gameState.basket.x, gameState.basket.y + 20, 15, 0, Math.PI);
            ctx.arc(gameState.basket.x + gameState.basket.width, gameState.basket.y + 20, 15, 0, Math.PI);
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 4;
            ctx.stroke();
        }
        
        function drawFruits() {
            gameState.fruits.forEach(fruit => {
                ctx.font = `${fruit.size}px Arial`;
                ctx.fillText(fruit.emoji, fruit.x, fruit.y + fruit.size);
            });
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –§–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98D8C8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawFruits();
            drawBasket();
        }
        
        let lastSpawn = 0;
        function gameLoop(timestamp = 0) {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            if (timestamp - lastSpawn > 1000) {
                spawnFruit();
                lastSpawn = timestamp;
            }
            
            updateBasket();
            updateFruits();
            draw();
            
            requestAnimationFrame(gameLoop);
        }
        
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('lives').textContent = '‚ù§Ô∏è'.repeat(gameState.lives);
        }
        
        function showQuestion() {
            gameState.isPaused = true;
            gameState.lastQuestionScore = gameState.score;
            
            // –í—ã–±–∏—Ä–∞–µ–º –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å
            let availableQuestions = questions.filter((q, i) => !gameState.usedQuestions.includes(i));
            if (availableQuestions.length === 0) {
                gameState.usedQuestions = [];
                availableQuestions = questions;
            }
            
            const questionIndex = questions.indexOf(availableQuestions[Math.floor(Math.random() * availableQuestions.length)]);
            gameState.currentQuestion = questionIndex;
            gameState.usedQuestions.push(questionIndex);
            
            const q = questions[questionIndex];
            document.getElementById('questionText').textContent = q.question;
            const buttons = document.querySelectorAll('.answer-btn');
            buttons[0].textContent = q.answers[0];
            buttons[1].textContent = q.answers[1];
            
            document.getElementById('questionModal').style.display = 'block';
        }
        
        function answerQuestion(answerIndex) {
            const q = questions[gameState.currentQuestion];
            document.getElementById('questionModal').style.display = 'none';
            
            if (answerIndex !== q.correct) {
                playSound('wrong'); // –ó–≤—É–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                gameState.score = Math.max(0, gameState.score - 5);
                updateUI();
            } else {
                playSound('correct'); // –ó–≤—É–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            }
            
            gameState.isPaused = false;
            gameLoop();
        }
        
        function winGame() {
            gameState.isPlaying = false;
            gameState.won = true;
            playSound('win'); // –ó–≤—É–∫ –ø–æ–±–µ–¥—ã
            showFireworks();

            // üëâ —Å–æ–æ–±—â–∞–µ–º –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, —á—Ç–æ –∏–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω–∞ (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ)
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'boardSuccess' }, '*');
            }

            setTimeout(() => {
                document.getElementById('modalTitle').textContent = 'üéâ –ü–æ–±–µ–¥–∞! üéâ';
                document.getElementById('modalText').textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –Ω–∞–±—Ä–∞–ª–∏ 50 –æ—á–∫–æ–≤ –∏ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã!';
                document.getElementById('modal').style.display = 'block';
            }, 3000);
        }

        function endGame() {
            gameState.isPlaying = false;
            document.getElementById('modalTitle').textContent = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞';
            document.getElementById('modalText').textContent = `–í—ã –Ω–∞–±—Ä–∞–ª–∏ ${gameState.score} –æ—á–∫–æ–≤!`;
            document.getElementById('modal').style.display = 'block';
        }

        // –§–µ–π–µ—Ä–≤–µ—Ä–∫
        function showFireworks() {
            fireworksCanvas.style.display = 'block';
            const particles = [];
            
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    life: 100
                });
            }
            
            function animateFireworks() {
                fireworksCtx.clearRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
                
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1;
                    p.life -= 2;
                    
                    fireworksCtx.fillStyle = p.color;
                    fireworksCtx.globalAlpha = p.life / 100;
                    fireworksCtx.beginPath();
                    fireworksCtx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                    fireworksCtx.fill();
                    
                    if (p.life <= 0) {
                        particles.splice(i, 1);
                    }
                }
                
                if (particles.length > 0) {
                    requestAnimationFrame(animateFireworks);
                } else {
                    fireworksCanvas.style.display = 'none';
                }
            }
            
            animateFireworks();
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ / –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
        function openRules() {
            gameState.isPaused = true;
            document.getElementById('rulesModal').style.display = 'block';
        }

        function closeRules() {
            document.getElementById('rulesModal').style.display = 'none';
            gameState.isPaused = false;
            if (gameState.isPlaying) {
                gameLoop();
            }
        }

        // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü—Ä–∞–≤–∏–ª–∞"
        document.getElementById('rulesButton').addEventListener('click', openRules);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –æ–∫–Ω–æ
        document.getElementById('modal').style.display = 'block';
    </script>
</body>
</html>
